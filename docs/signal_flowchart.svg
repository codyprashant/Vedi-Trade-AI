<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1600" height="2000" viewBox="0 0 1600 2000">
  <defs>
    <style>
      .box { fill:#ffffff; stroke:#2d3748; stroke-width:2; rx:8; ry:8; }
      .diamond { fill:#ffffff; stroke:#2d3748; stroke-width:2; }
      .ellipse { fill:#ffffff; stroke:#2d3748; stroke-width:2; }
      .arrow { stroke:#2d3748; stroke-width:2; fill:none; marker-end:url(#arrowhead); }
      .text { font-family: Arial, sans-serif; font-size:14px; fill:#1a202c; }
      .caption { font-size:12px; fill:#4a5568; }
      .note { fill:#edf2f7; stroke:#cbd5e0; stroke-width:1; rx:6; ry:6; }
      .enhanced { fill:#e6fffa; stroke:#38b2ac; stroke-width:2; rx:8; ry:8; }
      .signal { fill:#fef5e7; stroke:#ed8936; stroke-width:2; rx:8; ry:8; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#2d3748" />
    </marker>
  </defs>

  <!-- Title -->
  <text class="text" x="800" y="40" text-anchor="middle" font-size="24" font-weight="bold">VediTrading AI - Enhanced Signal Processing Flow (2025)</text>
  <text class="caption" x="800" y="65" text-anchor="middle">Multi-Asset Trading System with 21 Technical Indicators, Signal History & Real-time Integration</text>

  <!-- Start -->
  <ellipse class="ellipse" cx="800" cy="120" rx="120" ry="35" />
  <text class="text" x="800" y="125" text-anchor="middle">Start Signal Engine</text>

  <!-- Load Strategy Config -->
  <rect class="enhanced" x="600" y="180" width="400" height="90" />
  <text class="text" x="800" y="210" text-anchor="middle">Load Active Strategy Config</text>
  <text class="caption" x="800" y="230" text-anchor="middle">Multi-asset symbols, 21 indicators, weights, timeframes</text>
  <text class="caption" x="800" y="250" text-anchor="middle">signal_threshold, run_interval_seconds (≥600s)</text>

  <!-- Multi-Symbol Processing -->
  <rect class="box" x="600" y="300" width="400" height="80" />
  <text class="text" x="800" y="330" text-anchor="middle">Iterate Through Configured Symbols</text>
  <text class="caption" x="800" y="350" text-anchor="middle">XAUUSD, EURUSD, GBPUSD, USDJPY, etc.</text>

  <!-- Fetch Multi-Timeframe Data -->
  <rect class="box" x="600" y="410" width="400" height="90" />
  <text class="text" x="800" y="440" text-anchor="middle">Fetch Multi-Timeframe Data (Concurrent)</text>
  <text class="caption" x="800" y="460" text-anchor="middle">Primary (M15), Confirmation (H1), Trend (H4)</text>
  <text class="caption" x="800" y="480" text-anchor="middle">DEFAULT_HISTORY_COUNT ≈ 200 candles each</text>

  <!-- Data Validation -->
  <polygon class="diamond" points="800,530 900,570 800,610 700,570" />
  <text class="text" x="800" y="575" text-anchor="middle">Data Sufficient?</text>
  <text class="caption" x="800" y="590" text-anchor="middle">≥50 candles each TF</text>

  <!-- No branch: insufficient data -->
  <path class="arrow" d="M700,570 C600,570 550,630 550,690" />
  <rect class="note" x="430" y="690" width="240" height="80" />
  <text class="text" x="550" y="720" text-anchor="middle">Log "insufficient_data"</text>
  <text class="caption" x="550" y="740" text-anchor="middle">Continue next symbol</text>
  <text class="caption" x="550" y="755" text-anchor="middle">Update fetch metrics</text>

  <!-- Yes branch: compute indicators -->
  <path class="arrow" d="M900,570 C1000,570 1050,630 1050,690" />
  <rect class="enhanced" x="850" y="690" width="400" height="110" />
  <text class="text" x="1050" y="720" text-anchor="middle">Compute 21 Technical Indicators (M15)</text>
  <text class="caption" x="1050" y="740" text-anchor="middle">Core: RSI, MACD, SMA, EMA, BBANDS, STOCH, ATR</text>
  <text class="caption" x="1050" y="755" text-anchor="middle">Advanced: PRICE_ACTION, CCI, WILLIAMS_R, MFI</text>
  <text class="caption" x="1050" y="770" text-anchor="middle">Multi-TF: ADX, AROON, PSAR, TRIX, VORTEX, etc.</text>
  <text class="caption" x="1050" y="785" text-anchor="middle">All values with 2 decimal precision</text>

  <!-- Evaluate Signals -->
  <rect class="box" x="850" y="830" width="400" height="100" />
  <text class="text" x="1050" y="860" text-anchor="middle">Evaluate Signal Directions & Strategy</text>
  <text class="caption" x="1050" y="880" text-anchor="middle">Per-indicator: buy/sell/neutral evaluations</text>
  <text class="caption" x="1050" y="895" text-anchor="middle">Compute weighted strategy strengths</text>
  <text class="caption" x="1050" y="910" text-anchor="middle">Select best direction with highest strength</text>

  <!-- Best Direction Decision -->
  <polygon class="diamond" points="1050,960 1150,1000 1050,1040 950,1000" />
  <text class="text" x="1050" y="1005" text-anchor="middle">Best Direction?</text>
  <text class="caption" x="1050" y="1020" text-anchor="middle">buy/sell found</text>

  <!-- No: log no_action -->
  <path class="arrow" d="M950,1000 C850,1000 800,1060 800,1120" />
  <rect class="note" x="680" y="1120" width="240" height="90" />
  <text class="text" x="800" y="1150" text-anchor="middle">Log "no_action"</text>
  <text class="caption" x="800" y="1170" text-anchor="middle">Save indicator snapshot</text>
  <text class="caption" x="800" y="1185" text-anchor="middle">Update metrics & continue</text>

  <!-- Yes: compute trend alignment -->
  <path class="arrow" d="M1150,1000 C1250,1000 1300,1060 1300,1120" />
  <rect class="enhanced" x="1100" y="1120" width="400" height="100" />
  <text class="text" x="1300" y="1150" text-anchor="middle">Compute H1/H4 Trend Alignment</text>
  <text class="caption" x="1300" y="1170" text-anchor="middle">H1: EMA(50/200), ATR cache with timestamps</text>
  <text class="caption" x="1300" y="1185" text-anchor="middle">H4: EMA trend direction for boost calculation</text>
  <text class="caption" x="1300" y="1200" text-anchor="middle">Cache per symbol to avoid recomputation</text>

  <!-- M15 aligns with H1? -->
  <polygon class="diamond" points="1300,1250 1400,1290 1300,1330 1200,1290" />
  <text class="text" x="1300" y="1295" text-anchor="middle">M15 aligns H1?</text>
  <text class="caption" x="1300" y="1310" text-anchor="middle">Direction match</text>

  <!-- No: misaligned handling -->
  <path class="arrow" d="M1200,1290 C1100,1290 1050,1350 1050,1410" />
  <rect class="note" x="930" y="1410" width="240" height="110" />
  <text class="text" x="1050" y="1440" text-anchor="middle">Misaligned Handling</text>
  <text class="caption" x="1050" y="1460" text-anchor="middle">Auto Run: Skip signal generation</text>
  <text class="caption" x="1050" y="1475" text-anchor="middle">Manual Compute: Continue analysis</text>
  <text class="caption" x="1050" y="1490" text-anchor="middle">Log detailed metrics & summary</text>

  <!-- Yes: volatility analysis -->
  <path class="arrow" d="M1400,1290 C1500,1290 1550,1350 1550,1410" />
  <rect class="enhanced" x="1350" y="1410" width="400" height="100" />
  <text class="text" x="1550" y="1440" text-anchor="middle">Advanced Volatility Analysis</text>
  <text class="caption" x="1550" y="1460" text-anchor="middle">H1 ATR classification: Extreme/High/Normal/Low</text>
  <text class="caption" x="1550" y="1475" text-anchor="middle">Dynamic risk management based on volatility</text>
  <text class="caption" x="1550" y="1490" text-anchor="middle">Skip if extreme volatility detected</text>

  <!-- Extreme volatility check -->
  <polygon class="diamond" points="1550,1540 1650,1580 1550,1620 1450,1580" />
  <text class="text" x="1550" y="1585" text-anchor="middle">Extreme Vol?</text>

  <!-- Yes: skip extreme -->
  <path class="arrow" d="M1450,1580 C1350,1580 1300,1640 1300,1700" />
  <rect class="note" x="1180" y="1700" width="240" height="80" />
  <text class="text" x="1300" y="1730" text-anchor="middle">Skip Extreme Volatility</text>
  <text class="caption" x="1300" y="1750" text-anchor="middle">Log reason & continue next symbol</text>

  <!-- No: compute trade plan -->
  <path class="arrow" d="M1650,1580 C1750,1580 1800,1640 1800,1700" />
  <rect class="signal" x="1600" y="1700" width="400" height="110" />
  <text class="text" x="1800" y="1730" text-anchor="middle">Compute Enhanced Trade Plan</text>
  <text class="caption" x="1800" y="1750" text-anchor="middle">Entry, Stop Loss, Take Profit with precision</text>
  <text class="caption" x="1800" y="1765" text-anchor="middle">Risk-Reward ratio calculation</text>
  <text class="caption" x="1800" y="1780" text-anchor="middle">Volatility-adjusted position sizing</text>

  <!-- Signal Strength Calculation -->
  <rect class="signal" x="1200" y="1840" width="400" height="120" />
  <text class="text" x="1400" y="1870" text-anchor="middle">Final Signal Strength Calculation</text>
  <text class="caption" x="1400" y="1890" text-anchor="middle">Base strength from 21 indicator contributions</text>
  <text class="caption" x="1400" y="1905" text-anchor="middle">H1 alignment boost (+ALIGNMENT_BOOST_H1%)</text>
  <text class="caption" x="1400" y="1920" text-anchor="middle">H4 trend boost (+ALIGNMENT_BOOST_H4%)</text>
  <text class="caption" x="1400" y="1935" text-anchor="middle">Final = min(100, base + H1_boost + H4_boost)</text>

  <!-- Signal Threshold Check -->
  <polygon class="diamond" points="1400,1990 1500,2030 1400,2070 1300,2030" />
  <text class="text" x="1400" y="2035" text-anchor="middle">Final ≥ Threshold?</text>
  <text class="caption" x="1400" y="2050" text-anchor="middle">Configurable threshold</text>

  <!-- No: log skipped -->
  <path class="arrow" d="M1300,2030 C1200,2030 1150,2090 1150,2150" />
  <rect class="note" x="1030" y="2150" width="240" height="90" />
  <text class="text" x="1150" y="2180" text-anchor="middle">Log "insert_skipped"</text>
  <text class="caption" x="1150" y="2200" text-anchor="middle">Below threshold - no signal</text>
  <text class="caption" x="1150" y="2215" text-anchor="middle">Update frequency metrics</text>

  <!-- Yes: insert signal with history -->
  <path class="arrow" d="M1500,2030 C1600,2030 1650,2090 1650,2150" />
  <rect class="signal" x="1450" y="2150" width="400" height="130" />
  <text class="text" x="1650" y="2180" text-anchor="middle">Insert Signal & Update History</text>
  <text class="caption" x="1650" y="2200" text-anchor="middle">Save to database with full specifications</text>
  <text class="caption" x="1650" y="2215" text-anchor="middle">Update latestSignal for WebSocket</text>
  <text class="caption" x="1650" y="2230" text-anchor="middle">Maintain signalHistory (last 10 signals)</text>
  <text class="caption" x="1650" y="2245" text-anchor="middle">Real-time broadcast to connected clients</text>
  <text class="caption" x="1650" y="2260" text-anchor="middle">Log comprehensive metrics & frequency</text>

  <!-- Indicator Snapshot Process -->
  <rect class="enhanced" x="50" y="1120" width="300" height="120" />
  <text class="text" x="200" y="1150" text-anchor="middle">Indicator Snapshot Process</text>
  <text class="caption" x="200" y="1170" text-anchor="middle">Auto: Every ≥10 minutes per symbol</text>
  <text class="caption" x="200" y="1185" text-anchor="middle">Manual: Opportunistic on compute_once</text>
  <text class="caption" x="200" y="1200" text-anchor="middle">Store all 21 indicators with evaluations</text>
  <text class="caption" x="200" y="1215" text-anchor="middle">Timestamp-based deduplication</text>

  <!-- WebSocket Integration -->
  <rect class="enhanced" x="50" y="1280" width="300" height="120" />
  <text class="text" x="200" y="1310" text-anchor="middle">Real-time WebSocket Integration</text>
  <text class="caption" x="200" y="1330" text-anchor="middle">Enhanced response with signal data</text>
  <text class="caption" x="200" y="1345" text-anchor="middle">latestSignal: Current active signal</text>
  <text class="caption" x="200" y="1360" text-anchor="middle">signalHistory: Last 10 signals</text>
  <text class="caption" x="200" y="1375" text-anchor="middle">21 indicators with 2 decimal precision</text>

  <!-- Legend -->
  <rect x="50" y="50" width="320" height="200" class="note" />
  <text class="text" x="210" y="80" text-anchor="middle" font-weight="bold">Enhanced Legend (2025)</text>
  <rect x="70" y="100" width="25" height="20" class="box" />
  <text class="caption" x="105" y="115"> Standard Process</text>
  <rect x="70" y="130" width="25" height="20" class="enhanced" />
  <text class="caption" x="105" y="145"> Enhanced Feature</text>
  <rect x="70" y="160" width="25" height="20" class="signal" />
  <text class="caption" x="105" y="175"> Signal Processing</text>
  <polygon points="70,200 90,210 70,220 50,210" class="diamond" />
  <text class="caption" x="105" y="215"> Decision Point</text>
  <ellipse cx="80" cy="235" rx="15" ry="10" class="ellipse" />
  <text class="caption" x="105" y="240"> Start/End</text>

  <!-- Arrows -->
  <path class="arrow" d="M800,155 L800,180" />
  <path class="arrow" d="M800,270 L800,300" />
  <path class="arrow" d="M800,380 L800,410" />
  <path class="arrow" d="M800,500 L800,530" />
  <path class="arrow" d="M1050,800 L1050,830" />
  <path class="arrow" d="M1050,930 L1050,960" />
  <path class="arrow" d="M1300,1220 L1300,1250" />
  <path class="arrow" d="M1550,1510 L1550,1540" />
  <path class="arrow" d="M1800,1810 L1400,1840" />
  <path class="arrow" d="M1400,1960 L1400,1990" />

</svg>